def get_question_prompt(text, number=None, length=500):
    if number is None:
        number = max(1, len(text) // length)

    return f"""\
# 角色使命
你是一位专业的文本分析专家，擅长从复杂文本中提取关键信息并生成可用于模型微调的结构化数据（仅生成问题）。

## 核心任务
根据用户提供的文本（长度：{len(text)} 字），生成约 {number} 个高质量问题。

## 约束条件（必须严格遵守！）
- 所有问题必须基于原文内容提出，确保答案可在原文中找到依据
- 题目必须具备独立可读性，即脱离原文也能清晰理解问题
- 应覆盖文本的多个核心知识点或信息层面
- 禁止生成假设性、重复或相似问题
- 问题必须跟半导体技术相关

## 处理流程
1. 【文本解析】分段处理内容，识别关键实体、核心概念及其关系
2. 【问题生成】结合信息密度与教学价值，挑选高价值信息点进行提问
3. 【质量检查】确保题目完整、详细、无歧义、自包含、有深度和教学价值

## 输出格式
- 输出为标准 JSON 数组
- 使用英文双引号包裹所有字符串
- 输出的 JSON 数组必须严格符合以下结构：
```json
["问题1", "问题2", "..."]
```

## 待处理文本
{text}

## 限制
- 必须按照规定的 JSON 格式输出，不要输出任何其他不相关内容
- 问题不要和材料本身相关，例如禁止出现作者、章节、目录等相关问题
- 问题不得包含【报告、文章、文献、表格】中提到的这种话术，必须是一个自然的问题
"""


def get_answer_prompt(text, question):
    return f"""\
# Role: 微调数据集生成专家
## Profile:
- Description: 你是一名微调数据集生成专家，擅长从给定的内容中生成准确的问题答案，确保答案的准确性和相关性。你要直接回答用户问题，所有信息已内化为你的专业知识。

## Skills:
1. 答案必须基于给定的内容
2. 答案必须准确，不能胡编乱造
3. 答案必须与问题相关
4. 答案必须符合逻辑
5. 基于给定参考内容，用自然流畅的语言整合成一个完整答案，不需要提及文献来源或引用标记

## Workflow:
1. Take a deep breath and work on this problem step-by-step.
2. 首先，分析给定的文件内容
3. 然后，从内容中提取关键信息
4. 接着，生成与问题相关的准确答案
5. 最后，确保答案的准确性和相关性

## 参考内容
{text}

## 问题
{question}

## Constrains:
1. 答案必须基于给定的内容
2. 答案必须准确，必须与问题相关，不能胡编乱造
3. 答案必须充分、详细、包含所有必要的信息，适合微调大模型训练使用
4. 答案中不得出现 '参考/依据/文献中提到' 等任何引用性表述，只需呈现最终结果
"""


def get_cot_prompt(question, answer, think):
    return f"""\
# Role: 思维链优化专家
## Profile:
- Description: 你是一位擅长优化思维链的专家，能够对给定的思维链进行处理，去除其中的参考引用相关话术，使其呈现为一个正常的推理过程。

## Skills:
1. 准确识别并去除思维链中的参考引用话术
2. 确保优化后的思维链逻辑连贯、推理合理
3. 维持思维链与原始问题和答案的相关性

## Workflow:
1. 仔细研读原始问题、答案和优化前的思维链
2. 识别思维链中所有参考引用相关的表述，如"参考XX资料"、"文档中提及XX"、"参考内容中提及XXX"等
3. 去除这些引用话术，同时调整语句，保证思维链的逻辑连贯性
4. 检查优化后的思维链是否仍然能够合理地推导出答案，并且与原始问题紧密相关

## 原始问题
{question}

## 答案
{answer}

## 优化前的思维链
{think}

## Constrains:
1. 优化后的思维链必须去除所有参考引用相关话术
2. 思维链的逻辑推理过程必须完整且合理
3. 优化后的思维链必须与原始问题和答案保持紧密关联
4. 给出的答案不要包含"优化后的思维链"这样的话术，直接给出优化后的思维链结果
5. 思维链应按照正常的推理思路返回，如：先分析理解问题的本质，按照"首先、然后、接着、另外、最后"等步骤逐步思考，展示一个完善的推理过程
"""


SUMMARY_BASE = '''\
你是一位技术文档分析助手，擅长从专业文章中提取结构化知识。

请阅读以下技术性文章片段，并总结其主要内容。

要求：
- 提炼主要观点、关键术语和技术要点
- 准确反映该片段的讲解内容及其展开逻辑
- 使用清晰的小标题或编号分点，帮助理解内容结构
- 避免泛泛而谈，注重具体信息和相关技术细节
- 如有错别字或表达不清之处，请结合上下文适当修正
- 请直接给出总结内容，避免使用“总结如下”等冗余措辞

文章片段如下：
{text}
'''


SUMMARY_REFINE = '''\
你是一位技术文档分析助手，擅长从专业文章中提取结构化知识。

你正在对一篇技术性文章进行逐步总结，目前已有的总结如下：
{existing_answer}

请阅读接下来的新片段：
{text}

任务：将新内容与已有总结整合，形成结构清晰、内容完整的更新版总结。

要求：
- 必要时优化原有结构，在合适位置补充新增要点
- 如有重复，请融合或合并描述；如有层级关系，请适当嵌套整理
- 突出当前为止的讲解思路与技术脉络
- 用简洁明确的表达呈现，不必过多复述原文
- 如有错别字或表达不清之处，请结合上下文适当修正
- 请直接给出总结内容，避免使用“总结如下”等冗余措辞

请输出更新后的整合总结：
'''


def get_refine_prompt(text):
    return f'''\
请根据以下要求优化文本内容：
1. 删除所有与半导体技术无关的部分，仅保留涉及半导体材料、工艺、器件、设计、制造、测试等方面的知识性内容。
2. 在删除无关内容后，继续优化剩余文本的语言表达，要求准确、清晰、专业，符合正式技术文档的风格。
3. 对于保留的文本，不得随意增删改。若发现明显技术性错误，可在确保准确性的前提下适当修正。
4. 仅输出最终优化后的文本内容（如果内容为空，则直接输出""），无需任何解释。

待处理文本如下：
{text}
'''
