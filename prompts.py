def get_question_prompt(text, number=None, length=500):
    if number is None:
        number = max(1, len(text) // length)

    return f"""
# 角色使命
你是一位专业的文本分析专家，擅长从复杂文本中提取关键信息并生成可用于模型微调的结构化数据（仅生成问题）。

## 核心任务
根据用户提供的文本（长度：{len(text)} 字），生成不少于 {number} 个高质量问题。

## 约束条件（重要！）
- 必须基于文本内容直接生成
- 问题应具有明确答案指向性
- 需覆盖文本的不同方面
- 禁止生成假设性、重复或相似问题

## 处理流程
1. 【文本解析】分段处理内容，识别关键实体和核心概念
2. 【问题生成】基于信息密度选择最佳提问点
3. 【质量检查】确保：
   - 问题答案可在原文中找到依据
   - 标签与问题内容强相关
   - 无格式错误

## 输出格式
- JSON 数组格式必须正确
- 字段名使用英文双引号
- 输出的 JSON 数组必须严格符合以下结构：
```json
["问题1", "问题2", "..."]
```

## 输出示例
```json
["人工智能伦理框架应包含哪些核心要素？", "民法典对个人数据保护有哪些新规定？"]
```

## 待处理文本
{text}

## 限制
- 必须按照规定的 JSON 格式输出，不要输出任何其他不相关内容
- 生成不少于 {number} 个高质量问题
- 问题不要和材料本身相关，例如禁止出现作者、章节、目录等相关问题
- 问题不得包含【报告、文章、文献、表格】中提到的这种话术，必须是一个自然的问题
"""


def get_answer_prompt(text, question):
    return f"""
# Role: 微调数据集生成专家
## Profile:
- Description: 你是一名微调数据集生成专家，擅长从给定的内容中生成准确的问题答案，确保答案的准确性和相关性。你要直接回答用户问题，所有信息已内化为你的专业知识。

## Skills:
1. 答案必须基于给定的内容
2. 答案必须准确，不能胡编乱造
3. 答案必须与问题相关
4. 答案必须符合逻辑
5. 基于给定参考内容，用自然流畅的语言整合成一个完整答案，不需要提及文献来源或引用标记

## Workflow:
1. Take a deep breath and work on this problem step-by-step.
2. 首先，分析给定的文件内容
3. 然后，从内容中提取关键信息
4. 接着，生成与问题相关的准确答案
5. 最后，确保答案的准确性和相关性

## 参考内容
{text}

## 问题
{question}

## Constrains:
1. 答案必须基于给定的内容
2. 答案必须准确，必须与问题相关，不能胡编乱造
3. 答案必须充分、详细、包含所有必要的信息，适合微调大模型训练使用
4. 答案中不得出现 '参考/依据/文献中提到' 等任何引用性表述，只需呈现最终结果
"""


def get_cot_prompt(question, answer, think):
    return f"""
# Role: 思维链优化专家
## Profile:
- Description: 你是一位擅长优化思维链的专家，能够对给定的思维链进行处理，去除其中的参考引用相关话术，使其呈现为一个正常的推理过程。

## Skills:
1. 准确识别并去除思维链中的参考引用话术
2. 确保优化后的思维链逻辑连贯、推理合理
3. 维持思维链与原始问题和答案的相关性

## Workflow:
1. 仔细研读原始问题、答案和优化前的思维链
2. 识别思维链中所有参考引用相关的表述，如"参考XX资料"、"文档中提及XX"、"参考内容中提及XXX"等
3. 去除这些引用话术，同时调整语句，保证思维链的逻辑连贯性
4. 检查优化后的思维链是否仍然能够合理地推导出答案，并且与原始问题紧密相关

## 原始问题
{question}

## 答案
{answer}

## 优化前的思维链
{think}

## Constrains:
1. 优化后的思维链必须去除所有参考引用相关话术
2. 思维链的逻辑推理过程必须完整且合理
3. 优化后的思维链必须与原始问题和答案保持紧密关联
4. 给出的答案不要包含"优化后的思维链"这样的话术，直接给出优化后的思维链结果
5. 思维链应按照正常的推理思路返回，如：先分析理解问题的本质，按照"首先、然后、接着、另外、最后"等步骤逐步思考，展示一个完善的推理过程
"""


PROMPT = '''\
你是一位技术文档分析助手，擅长从专业文章中提取结构化知识。

请阅读以下技术性文章片段，并总结其主要内容。

要求：
- 提炼主要观点、关键术语和技术要点
- 准确反映该片段的讲解内容及其展开逻辑
- 使用清晰的小标题或编号分点，帮助理解内容结构
- 避免泛泛而谈，注重具体信息和相关技术细节
- 如有错别字或表达不清之处，请结合上下文适当修正
- 请直接给出总结内容，避免使用“总结如下”等冗余措辞

文章片段如下：
{text}
'''


REFINE_PROMPT = '''\
你是一位技术文档分析助手，擅长从专业文章中提取结构化知识。

你正在对一篇技术性文章进行逐步总结，目前已有的总结如下：
{existing_answer}

请阅读接下来的新片段：
{text}

任务：将新内容与已有总结整合，形成结构清晰、内容完整的更新版总结。

要求：
- 必要时优化原有结构，在合适位置补充新增要点
- 如有重复，请融合或合并描述；如有层级关系，请适当嵌套整理
- 突出当前为止的讲解思路与技术脉络
- 用简洁明确的表达呈现，不必过多复述原文
- 如有错别字或表达不清之处，请结合上下文适当修正
- 请直接给出总结内容，避免使用“总结如下”等冗余措辞

请输出更新后的整合总结：
'''
